#!/bin/bash

display_usage() {
    echo -e "Usage: sp"
}

display_summary() {
    echo -e "Start Project: Find projects with executable setup scripts (start_project.local.sh).\n"
    echo -e "               For the selected projects, run the setup scripts that create a tmux session.\n"
}

if [ $# -eq 0 ]; then
    PROJECT_STARTUP_SELECTION=$(cd $HOME; fd --type executable --absolute-path start_project.local.sh | gxargs -I{} dirname {} | fzf --multi)

    IFS=$'\n' read -rd '' -a SELECTION_ARRAY <<<"$PROJECT_STARTUP_SELECTION"
    for directory in "${SELECTION_ARRAY[@]}"
    do
        PROJECT_NAME=$(basename $directory)
        echo "Starting project setup: $PROJECT_NAME"
        cd "$directory"
        ./start_project.local.sh
        echo "Finished project setup: $PROJECT_NAME"
    done

else
    display_summary
    display_usage
fi

