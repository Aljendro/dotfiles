#!/usr/bin/env node

import yargs from 'yargs';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';
import { hideBin } from 'yargs/helpers';
import { loadCommands } from '@aljendro/cli_utilities';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
const commandsDir = join(__dirname, '../commands');

// Load and register all commands dynamically
const commands = await loadCommands(commandsDir);
const yargsInstance = yargs(hideBin(process.argv));

// Register each command
for (const command of commands) {
  yargsInstance.command(command);
}

// Configure yargs
yargsInstance
  .demandCommand(1, 'You need at least one command before moving on')
  .strict()
  .help()
  .alias('help', 'h')
  .parse();
